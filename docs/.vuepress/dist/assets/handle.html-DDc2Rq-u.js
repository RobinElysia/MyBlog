import{_ as s,c as a,h as p,a as t}from"./app-DFfsekp4.js";const e={};function c(l,n){return t(),a("div",null,n[0]||(n[0]=[p(`<div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ---------------- SECURITY ATTRIBUTES ----------------</span></span>
<span class="line">    <span class="token comment">// This structure defines handle inheritance behavior.</span></span>
<span class="line">    <span class="token comment">// bInheritHandle = TRUE means created handles can be inherited by child processes.</span></span>
<span class="line">    SECURITY_ATTRIBUTES sa<span class="token punctuation">;</span></span>
<span class="line">    sa<span class="token punctuation">.</span>nLength <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>SECURITY_ATTRIBUTES<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    sa<span class="token punctuation">.</span>bInheritHandle <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>   <span class="token comment">// allow handle inheritance</span></span>
<span class="line">    sa<span class="token punctuation">.</span>lpSecurityDescriptor <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    HANDLE hChildStdoutRd <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// Parent will read from this (child&#39;s stdout)</span></span>
<span class="line">    HANDLE hChildStdoutWr <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// Child will write to this (stdout)</span></span>
<span class="line">    HANDLE hChildStdinRd  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// Child will read from this (stdin)</span></span>
<span class="line">    HANDLE hChildStdinWr  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// Parent will write to this (stdin)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- CREATE PIPE FOR STDOUT ----------------</span></span>
<span class="line">    <span class="token comment">// Create a pipe that redirects child process&#39;s stdout to the parent.</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreatePipe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hChildStdoutRd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hChildStdoutWr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sa<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Stdout pipe creation failed\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// Prevent parent from accidentally inheriting the read end of stdout.</span></span>
<span class="line">    <span class="token comment">// We want only the parent to use hChildStdoutRd, not the child.</span></span>
<span class="line">    <span class="token function">SetHandleInformation</span><span class="token punctuation">(</span>hChildStdoutRd<span class="token punctuation">,</span> HANDLE_FLAG_INHERIT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- CREATE PIPE FOR STDIN ----------------</span></span>
<span class="line">    <span class="token comment">// Create a pipe that redirects parent&#39;s input into the child process&#39;s stdin.</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreatePipe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hChildStdinRd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hChildStdinWr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sa<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Stdin pipe creation failed\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// Prevent parent from inheriting the write end of stdin (child should not inherit it).</span></span>
<span class="line">    <span class="token function">SetHandleInformation</span><span class="token punctuation">(</span>hChildStdinWr<span class="token punctuation">,</span> HANDLE_FLAG_INHERIT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- SETUP STARTUPINFO ----------------</span></span>
<span class="line">    <span class="token comment">// This structure tells CreateProcess which standard handles to use for the child.</span></span>
<span class="line">    STARTUPINFO si<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>si<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>STARTUPINFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    si<span class="token punctuation">.</span>cb <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>STARTUPINFO<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Redirect child&#39;s stdin, stdout, stderr to our pipe ends.</span></span>
<span class="line">    si<span class="token punctuation">.</span>hStdInput  <span class="token operator">=</span> hChildStdinRd<span class="token punctuation">;</span></span>
<span class="line">    si<span class="token punctuation">.</span>hStdOutput <span class="token operator">=</span> hChildStdoutWr<span class="token punctuation">;</span></span>
<span class="line">    si<span class="token punctuation">.</span>hStdError  <span class="token operator">=</span> hChildStdoutWr<span class="token punctuation">;</span>  <span class="token comment">// Redirect stderr to same as stdout</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// STARTF_USESTDHANDLES tells CreateProcess to use the above handles.</span></span>
<span class="line">    si<span class="token punctuation">.</span>dwFlags <span class="token operator">|=</span> STARTF_USESTDHANDLES<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    PROCESS_INFORMATION pi<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pi<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PROCESS_INFORMATION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- CREATE CHILD PROCESS ----------------</span></span>
<span class="line">    <span class="token comment">// Launch &quot;cmd.exe&quot; with redirected input/output.</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateProcess</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token constant">NULL</span><span class="token punctuation">,</span>                <span class="token comment">// Application name (NULL means use command line instead)</span></span>
<span class="line">        <span class="token punctuation">(</span>LPSTR<span class="token punctuation">)</span><span class="token string">&quot;cmd.exe&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// Command line (child process to run)</span></span>
<span class="line">        <span class="token constant">NULL</span><span class="token punctuation">,</span>                <span class="token comment">// Process security attributes</span></span>
<span class="line">        <span class="token constant">NULL</span><span class="token punctuation">,</span>                <span class="token comment">// Thread security attributes</span></span>
<span class="line">        TRUE<span class="token punctuation">,</span>                <span class="token comment">// Must be TRUE to allow handle inheritance</span></span>
<span class="line">        <span class="token number">0</span><span class="token punctuation">,</span>                   <span class="token comment">// Creation flags</span></span>
<span class="line">        <span class="token constant">NULL</span><span class="token punctuation">,</span>                <span class="token comment">// Use parent&#39;s environment variables</span></span>
<span class="line">        <span class="token constant">NULL</span><span class="token punctuation">,</span>                <span class="token comment">// Use parent&#39;s current directory</span></span>
<span class="line">        <span class="token operator">&amp;</span>si<span class="token punctuation">,</span>                 <span class="token comment">// STARTUPINFO with redirected handles</span></span>
<span class="line">        <span class="token operator">&amp;</span>pi                  <span class="token comment">// PROCESS_INFORMATION receives process/thread handles</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;CreateProcess failed (%d)\\n&quot;</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- CLOSE UNUSED HANDLES ----------------</span></span>
<span class="line">    <span class="token comment">// The parent process does not need to hold onto these anymore.</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hChildStdoutWr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent only reads from stdout, not write</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hChildStdinRd<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// parent only writes to stdin, not read</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- WRITE TO CHILD&#39;S STDIN ----------------</span></span>
<span class="line">    <span class="token comment">// Send a command (&quot;dir\\n&quot;) to the child process (cmd.exe).</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg <span class="token operator">=</span> <span class="token string">&quot;dir\\n&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    DWORD written<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">WriteFile</span><span class="token punctuation">(</span>hChildStdinWr<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>written<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Close parent&#39;s write end of stdin to signal EOF to the child.</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hChildStdinWr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- READ FROM CHILD&#39;S STDOUT ----------------</span></span>
<span class="line">    <span class="token comment">// Read whatever output cmd.exe produces and print it to parent&#39;s stdout.</span></span>
<span class="line">    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    DWORD readBytes<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>hChildStdoutRd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>readBytes<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> readBytes <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        buffer<span class="token punctuation">[</span>readBytes<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&#39;\\0&#39;</span><span class="token punctuation">;</span>  <span class="token comment">// Null-terminate buffer</span></span>
<span class="line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Print child&#39;s output to parent console</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- WAIT FOR CHILD TO FINISH ----------------</span></span>
<span class="line">    <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>pi<span class="token punctuation">.</span>hProcess<span class="token punctuation">,</span> INFINITE<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ---------------- CLEAN UP ----------------</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hChildStdoutRd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>pi<span class="token punctuation">.</span>hProcess<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>pi<span class="token punctuation">.</span>hThread<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)]))}const o=s(e,[["render",c]]),u=JSON.parse(`{"path":"/posts/OSDesign/code/handle.html","title":"CreateProcess + STARTUPINFO + 管道重定向","lang":"en-US","frontmatter":{"sidebar":false,"title":"CreateProcess + STARTUPINFO + 管道重定向","description":"CreateProcess + STARTUPINFO + 管道重定向","date":"2025-09-20T00:00:00.000Z","timeline":true,"head":[["meta",{"name":"keywords","content":"CreateProcess + STARTUPINFO + 管道重定向"}],["meta",{"name":"description","content":"CreateProcess + STARTUPINFO + 管道重定向"}],["meta",{"name":"author","content":"RobinElysia"}]],"category":["RobinElysia"],"tag":["code"]},"headers":[],"git":{"updatedTime":1762519389000,"contributors":[{"name":"qwp_p","username":"","email":"qwp20060309@outlook.com","commits":1}],"changelog":[{"hash":"cfd09171d1be97fa09ef8c4fc2be80d788219c63","time":1762519389000,"email":"qwp20060309@outlook.com","author":"qwp_p","message":"Update blog content and add new articles"}]},"filePathRelative":"posts/OSDesign/code/handle.md","excerpt":"<div class=\\"language-cpp line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"cpp\\"><pre><code><span class=\\"line\\"><span class=\\"token macro property\\"><span class=\\"token directive-hash\\">#</span><span class=\\"token directive keyword\\">include</span> <span class=\\"token string\\">&lt;windows.h&gt;</span></span></span>\\n<span class=\\"line\\"><span class=\\"token macro property\\"><span class=\\"token directive-hash\\">#</span><span class=\\"token directive keyword\\">include</span> <span class=\\"token string\\">&lt;stdio.h&gt;</span></span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">int</span> <span class=\\"token function\\">main</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- SECURITY ATTRIBUTES ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// This structure defines handle inheritance behavior.</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// bInheritHandle = TRUE means created handles can be inherited by child processes.</span></span>\\n<span class=\\"line\\">    SECURITY_ATTRIBUTES sa<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    sa<span class=\\"token punctuation\\">.</span>nLength <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">sizeof</span><span class=\\"token punctuation\\">(</span>SECURITY_ATTRIBUTES<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    sa<span class=\\"token punctuation\\">.</span>bInheritHandle <span class=\\"token operator\\">=</span> TRUE<span class=\\"token punctuation\\">;</span>   <span class=\\"token comment\\">// allow handle inheritance</span></span>\\n<span class=\\"line\\">    sa<span class=\\"token punctuation\\">.</span>lpSecurityDescriptor <span class=\\"token operator\\">=</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    HANDLE hChildStdoutRd <span class=\\"token operator\\">=</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Parent will read from this (child's stdout)</span></span>\\n<span class=\\"line\\">    HANDLE hChildStdoutWr <span class=\\"token operator\\">=</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Child will write to this (stdout)</span></span>\\n<span class=\\"line\\">    HANDLE hChildStdinRd  <span class=\\"token operator\\">=</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Child will read from this (stdin)</span></span>\\n<span class=\\"line\\">    HANDLE hChildStdinWr  <span class=\\"token operator\\">=</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Parent will write to this (stdin)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- CREATE PIPE FOR STDOUT ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Create a pipe that redirects child process's stdout to the parent.</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span><span class=\\"token function\\">CreatePipe</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">&amp;</span>hChildStdoutRd<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>hChildStdoutWr<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>sa<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token function\\">fprintf</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">stderr</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"Stdout pipe creation failed\\\\n\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">return</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Prevent parent from accidentally inheriting the read end of stdout.</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// We want only the parent to use hChildStdoutRd, not the child.</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">SetHandleInformation</span><span class=\\"token punctuation\\">(</span>hChildStdoutRd<span class=\\"token punctuation\\">,</span> HANDLE_FLAG_INHERIT<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- CREATE PIPE FOR STDIN ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Create a pipe that redirects parent's input into the child process's stdin.</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span><span class=\\"token function\\">CreatePipe</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">&amp;</span>hChildStdinRd<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>hChildStdinWr<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>sa<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token function\\">fprintf</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">stderr</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"Stdin pipe creation failed\\\\n\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">return</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Prevent parent from inheriting the write end of stdin (child should not inherit it).</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">SetHandleInformation</span><span class=\\"token punctuation\\">(</span>hChildStdinWr<span class=\\"token punctuation\\">,</span> HANDLE_FLAG_INHERIT<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- SETUP STARTUPINFO ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// This structure tells CreateProcess which standard handles to use for the child.</span></span>\\n<span class=\\"line\\">    STARTUPINFO si<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">ZeroMemory</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">&amp;</span>si<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">sizeof</span><span class=\\"token punctuation\\">(</span>STARTUPINFO<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    si<span class=\\"token punctuation\\">.</span>cb <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">sizeof</span><span class=\\"token punctuation\\">(</span>STARTUPINFO<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Redirect child's stdin, stdout, stderr to our pipe ends.</span></span>\\n<span class=\\"line\\">    si<span class=\\"token punctuation\\">.</span>hStdInput  <span class=\\"token operator\\">=</span> hChildStdinRd<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    si<span class=\\"token punctuation\\">.</span>hStdOutput <span class=\\"token operator\\">=</span> hChildStdoutWr<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    si<span class=\\"token punctuation\\">.</span>hStdError  <span class=\\"token operator\\">=</span> hChildStdoutWr<span class=\\"token punctuation\\">;</span>  <span class=\\"token comment\\">// Redirect stderr to same as stdout</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// STARTF_USESTDHANDLES tells CreateProcess to use the above handles.</span></span>\\n<span class=\\"line\\">    si<span class=\\"token punctuation\\">.</span>dwFlags <span class=\\"token operator\\">|=</span> STARTF_USESTDHANDLES<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    PROCESS_INFORMATION pi<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">ZeroMemory</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">&amp;</span>pi<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">sizeof</span><span class=\\"token punctuation\\">(</span>PROCESS_INFORMATION<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- CREATE CHILD PROCESS ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Launch \\"cmd.exe\\" with redirected input/output.</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span><span class=\\"token function\\">CreateProcess</span><span class=\\"token punctuation\\">(</span></span>\\n<span class=\\"line\\">        <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Application name (NULL means use command line instead)</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">(</span>LPSTR<span class=\\"token punctuation\\">)</span><span class=\\"token string\\">\\"cmd.exe\\"</span><span class=\\"token punctuation\\">,</span>    <span class=\\"token comment\\">// Command line (child process to run)</span></span>\\n<span class=\\"line\\">        <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Process security attributes</span></span>\\n<span class=\\"line\\">        <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Thread security attributes</span></span>\\n<span class=\\"line\\">        TRUE<span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Must be TRUE to allow handle inheritance</span></span>\\n<span class=\\"line\\">        <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span>                   <span class=\\"token comment\\">// Creation flags</span></span>\\n<span class=\\"line\\">        <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Use parent's environment variables</span></span>\\n<span class=\\"line\\">        <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">,</span>                <span class=\\"token comment\\">// Use parent's current directory</span></span>\\n<span class=\\"line\\">        <span class=\\"token operator\\">&amp;</span>si<span class=\\"token punctuation\\">,</span>                 <span class=\\"token comment\\">// STARTUPINFO with redirected handles</span></span>\\n<span class=\\"line\\">        <span class=\\"token operator\\">&amp;</span>pi                  <span class=\\"token comment\\">// PROCESS_INFORMATION receives process/thread handles</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token function\\">fprintf</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">stderr</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"CreateProcess failed (%d)\\\\n\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token function\\">GetLastError</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">return</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- CLOSE UNUSED HANDLES ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// The parent process does not need to hold onto these anymore.</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>hChildStdoutWr<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// parent only reads from stdout, not write</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>hChildStdinRd<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>  <span class=\\"token comment\\">// parent only writes to stdin, not read</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- WRITE TO CHILD'S STDIN ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Send a command (\\"dir\\\\n\\") to the child process (cmd.exe).</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">const</span> <span class=\\"token keyword\\">char</span> <span class=\\"token operator\\">*</span>msg <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"dir\\\\n\\"</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    DWORD written<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">WriteFile</span><span class=\\"token punctuation\\">(</span>hChildStdinWr<span class=\\"token punctuation\\">,</span> msg<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">(</span>DWORD<span class=\\"token punctuation\\">)</span><span class=\\"token function\\">strlen</span><span class=\\"token punctuation\\">(</span>msg<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>written<span class=\\"token punctuation\\">,</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Close parent's write end of stdin to signal EOF to the child.</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>hChildStdinWr<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- READ FROM CHILD'S STDOUT ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// Read whatever output cmd.exe produces and print it to parent's stdout.</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">char</span> buffer<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">4096</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    DWORD readBytes<span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">while</span> <span class=\\"token punctuation\\">(</span><span class=\\"token function\\">ReadFile</span><span class=\\"token punctuation\\">(</span>hChildStdoutRd<span class=\\"token punctuation\\">,</span> buffer<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">sizeof</span><span class=\\"token punctuation\\">(</span>buffer<span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">&amp;</span>readBytes<span class=\\"token punctuation\\">,</span> <span class=\\"token constant\\">NULL</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">&amp;&amp;</span> readBytes <span class=\\"token operator\\">&gt;</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        buffer<span class=\\"token punctuation\\">[</span>readBytes<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token char\\">'\\\\0'</span><span class=\\"token punctuation\\">;</span>  <span class=\\"token comment\\">// Null-terminate buffer</span></span>\\n<span class=\\"line\\">        <span class=\\"token function\\">printf</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"%s\\"</span><span class=\\"token punctuation\\">,</span> buffer<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>      <span class=\\"token comment\\">// Print child's output to parent console</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- WAIT FOR CHILD TO FINISH ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">WaitForSingleObject</span><span class=\\"token punctuation\\">(</span>pi<span class=\\"token punctuation\\">.</span>hProcess<span class=\\"token punctuation\\">,</span> INFINITE<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token comment\\">// ---------------- CLEAN UP ----------------</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>hChildStdoutRd<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>pi<span class=\\"token punctuation\\">.</span>hProcess<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\">    <span class=\\"token function\\">CloseHandle</span><span class=\\"token punctuation\\">(</span>pi<span class=\\"token punctuation\\">.</span>hThread<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">return</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}`);export{o as comp,u as data};
